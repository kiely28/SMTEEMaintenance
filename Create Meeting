<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="CreateMeeting.aspx.cs" Inherits="WebApplication1_MAL.CreateMeeting" %>

<%--<!DOCTYPE html>

<html xmlns="-http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
</head>
<body>
    <form id="form1" runat="server">
        <div>
        </div>
    </form>
</body>
</html>



<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="CreateMeeting.aspx.cs" Inherits="YourNamespace.CreateMeeting" %>--%>

<!DOCTYPE html>
<html>
<head runat="server">
    <title>Create Meeting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <form id="form2" runat="server" class="container mt-5">
        <h2>Create Meeting</h2>
        <div class="mb-3">
            <label for="txtTitle" class="form-label">Title/Agenda</label>
            <asp:TextBox ID="txtTitle" runat="server" CssClass="form-control" />
        </div>
        <div class="mb-3">
            <label for="txtStartDateTime" class="form-label">Start Date & Time</label>
            <asp:TextBox ID="txtStartDateTime" runat="server" CssClass="form-control" TextMode="DateTimeLocal" />
        </div>
        <div class="mb-3">
            <label for="txtEndDateTime" class="form-label">End Date & Time</label>
            <asp:TextBox ID="txtEndDateTime" runat="server" CssClass="form-control" TextMode="DateTimeLocal" />
        </div>
        <div class="mb-3">
            <label for="txtVenue" class="form-label">Venue/Location</label>
            <asp:TextBox ID="txtVenue" runat="server" CssClass="form-control" />
        </div>
        <div class="mb-3">
            <label for="txtOrganizer" class="form-label">Organizer</label>
            <asp:TextBox ID="txtOrganizer" runat="server" CssClass="form-control" />
        </div>
        <div class="mb-3">
            <label for="txtRemarks" class="form-label">Remarks</label>
            <asp:TextBox ID="txtRemarks" runat="server" CssClass="form-control" />
        </div>
        <asp:Button ID="btnSave" runat="server" Text="Save Meeting" CssClass="btn btn-primary" OnClick="btnSave_Click" />
        <br /><br />
        <asp:Label ID="lblResult" runat="server" CssClass="text-success fw-bold"></asp:Label>
    </form>
</body>
</html>

---

using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace WebApplication1_MAL
{
//    public partial class CreateMeeting : System.Web.UI.Page
//    {
//        protected void Page_Load(object sender, EventArgs e)
//        {

//        }
//    }
//}


//using System;
//using System.Data;
//using System.Data.SqlClient;
//using System.Configuration;

//namespace YourNamespace
//{
    public partial class CreateMeeting : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e) { }

        protected void btnSave_Click(object sender, EventArgs e)
        {
            string connStr = ConfigurationManager.ConnectionStrings["MeetingDb"].ConnectionString;
            string meetingId = "";
            string currentUser = Session["Username"].ToString();

            using (SqlConnection conn = new SqlConnection(connStr))
            {
                using (SqlCommand cmd = new SqlCommand("InsertMeeting1", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;

                    cmd.Parameters.AddWithValue("@Title", txtTitle.Text);
                    cmd.Parameters.AddWithValue("@StartDate", Convert.ToDateTime(txtStartDateTime.Text));
                    cmd.Parameters.AddWithValue("@EndDate", Convert.ToDateTime(txtEndDateTime.Text));
                    cmd.Parameters.AddWithValue("@Venue", txtVenue.Text);
                    cmd.Parameters.AddWithValue("@Organizer", txtOrganizer.Text);
                    //cmd.Parameters.AddWithValue("@Remarks", "Remarks");
                    cmd.Parameters.AddWithValue("@CreatedBy", currentUser);

                    SqlParameter outputParam = new SqlParameter("@MeetingId", SqlDbType.NVarChar, 50)
                    {
                        Direction = ParameterDirection.Output
                    };
                    cmd.Parameters.Add(outputParam);

                    conn.Open();
                    cmd.ExecuteNonQuery();
                    conn.Close();

                    meetingId = outputParam.Value.ToString();

                    lblResult.Text = $"Meeting saved successfully!<br/>Meeting ID: <strong>{meetingId}</strong>";
                }
            }
        }
    }
}

---

USE [db_MeetingAttendance]
GO
/****** Object:  StoredProcedure [dbo].[InsertMeeting1]    Script Date: 8/28/2025 4:10:03 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[InsertMeeting1]
    @Title NVARCHAR(200),
    @StartDate DATETIME,
    @EndDate DATETIME,
    @Venue NVARCHAR(100),
    @Organizer NVARCHAR(100),
    --@Remarks NVARCHAR(50),
	@CreatedBy NVARCHAR(100),
    @MeetingId NVARCHAR(50) OUTPUT
AS
BEGIN
    DECLARE @Prefix NVARCHAR(20) = 'MTG-' + FORMAT(GETDATE(), 'yyyyMM') + '-'

    DECLARE @LastSeq INT = (
        SELECT ISNULL(MAX(CAST(RIGHT(MeetingId, 3) AS INT)), 0)
        FROM Tbl_Meetings
        WHERE MeetingId LIKE @Prefix + '%'
    )

    DECLARE @NextSeq INT = @LastSeq + 1

    SET @MeetingId = @Prefix + RIGHT('000' + CAST(@NextSeq AS VARCHAR), 3)

    --INSERT INTO Tbl_Meetings (MeetingId, Title, StartDate, EndDate, Venue, Organizer, CreatedBy)
    --VALUES (@MeetingId, @Title, @StartDate, @EndDate, @Venue, @Organizer, @CreatedBy)
	
    INSERT INTO Tbl_Meetings (MeetingId, Title, StartDate, EndDate, Venue, Organizer, CreatedBy, Status)
    VALUES (@MeetingId, @Title, @StartDate, @EndDate, @Venue, @Organizer, @CreatedBy, 'Upcoming')
END
