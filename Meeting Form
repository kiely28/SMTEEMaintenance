<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="MeetingForm.aspx.cs" Inherits="WebApplication1_MAL.MeetingForm" %>

<!DOCTYPE html>
<html>
<head runat="server">
    <title>Meeting Attendance Logging</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <form id="form1" runat="server">
        <div class="container mt-5">
            <div class="card shadow rounded p-4">
                <h3 class="mb-4">Meeting Attendance Logging</h3>

                <div class="mb-3">
                    <label class="form-label">Title / Agenda</label>
                    <asp:TextBox ID="txtTitle" runat="server" CssClass="form-control" />
                </div>

                <div class="mb-3">
                    <label class="form-label">Start Date & Time</label>
                    <asp:TextBox ID="txtStart" runat="server" TextMode="DateTimeLocal" CssClass="form-control" />
                </div>

                <div class="mb-3">
                    <label class="form-label">End Date & Time</label>
                    <asp:TextBox ID="txtEnd" runat="server" TextMode="DateTimeLocal" CssClass="form-control" />
                </div>

                <div class="mb-3">
                    <label class="form-label">Venue / Location</label>
                    <asp:TextBox ID="txtVenue" runat="server" CssClass="form-control" />
                </div>

                <div class="mb-3">
                    <label class="form-label">Organizer</label>
                    <asp:TextBox ID="txtOrganizer" runat="server" CssClass="form-control" />
                </div>

                <asp:Button ID="btnSave" runat="server" Text="Save" CssClass="btn btn-primary" OnClick="btnSave_Click" />
                <asp:Label ID="lblStatus" runat="server" CssClass="form-text mt-3 text-success" />
            </div>
        </div>
    </form>
</body>
</html>

---


using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data; /*K. Evangelista*/
using System.Data.SqlClient;
using System.Configuration;

namespace WebApplication1_MAL
{
    public partial class MeetingForm : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e) { }

        protected void btnSave_Click(object sender, EventArgs e)
        {
            string title = txtTitle.Text;
            DateTime start = Convert.ToDateTime(txtStart.Text);
            DateTime end = Convert.ToDateTime(txtEnd.Text);
            string venue = txtVenue.Text;
            string organizer = txtOrganizer.Text;

            // Generate MeetingCode: MTG-yyyyMMdd-###
            string datePart = DateTime.Now.ToString("yyyyMMdd");
            string meetingCodePrefix = "MTG-" + datePart + "-";
            int nextSeq = GetNextMeetingSequence(datePart);
            string meetingCode = meetingCodePrefix + nextSeq.ToString("D3");

            string connStr = ConfigurationManager.ConnectionStrings["MeetingDb"].ConnectionString;

            using (SqlConnection conn = new SqlConnection(connStr))
            {
                using (SqlCommand cmd = new SqlCommand("InsertMeeting", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.Parameters.AddWithValue("@MeetingId", meetingCode);
                    cmd.Parameters.AddWithValue("@Title", title);
                    cmd.Parameters.AddWithValue("@MeetingDate", start);
                    cmd.Parameters.AddWithValue("@MeetingVenue", organizer);
                    cmd.Parameters.AddWithValue("@Host", venue);
                    cmd.Parameters.AddWithValue("@PlanStartTime", end);

                    conn.Open();
                    cmd.ExecuteNonQuery();
                    conn.Close();

                    //lblStatus.Text = "Meeting saved with ID: " + meetingCode;
                    Response.Redirect("MeetingDetails.aspx?meetingId=" + meetingCode + "&title=" + Server.UrlEncode(title));
                }
            }
        }

        private int GetNextMeetingSequence(string datePart)
        {
            int count = 0;
            string connStr = ConfigurationManager.ConnectionStrings["MeetingDb"].ConnectionString;

            using (SqlConnection conn = new SqlConnection(connStr))
            {
                string query = "SELECT COUNT(*) FROM Tbl_Meetings WHERE MeetingId LIKE @codePattern";
                using (SqlCommand cmd = new SqlCommand(query, conn))
                {
                    cmd.Parameters.AddWithValue("@codePattern", "MTG-" + datePart + "-%");

                    conn.Open();
                    count = (int)cmd.ExecuteScalar();
                    conn.Close();
                }
            }

            return count + 1;
        }
    }
}
